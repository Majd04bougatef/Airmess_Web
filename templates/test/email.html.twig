{% extends 'base.html.twig' %}

{% block title %}Email Test Results{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h2>Email Test Results</h2>
        </div>
        <div class="card-body">
            <h3>Test Results</h3>
            
            <div class="mt-4">
                <h4>Direct Mailer Test</h4>
                <div class="alert {% if result.direct_mailer starts with 'Success' %}alert-success{% else %}alert-danger{% endif %}">
                    {{ result.direct_mailer }}
                    
                    {% if result.direct_mailer_trace is defined %}
                        <button class="btn btn-sm btn-outline-secondary mt-2" type="button" data-bs-toggle="collapse" data-bs-target="#directMailerTrace">
                            Show Stack Trace
                        </button>
                        <div class="collapse mt-2" id="directMailerTrace">
                            <div class="card card-body">
                                <pre>{{ result.direct_mailer_trace }}</pre>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="mt-4">
                <h4>Verification Code Test</h4>
                <div class="alert {% if result.verification_code starts with 'Success' %}alert-success{% else %}alert-danger{% endif %}">
                    {{ result.verification_code }}
                    
                    {% if result.verification_code_trace is defined %}
                        <button class="btn btn-sm btn-outline-secondary mt-2" type="button" data-bs-toggle="collapse" data-bs-target="#verificationCodeTrace">
                            Show Stack Trace
                        </button>
                        <div class="collapse mt-2" id="verificationCodeTrace">
                            <div class="card card-body">
                                <pre>{{ result.verification_code_trace }}</pre>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="mt-4">
                <a href="{{ path('app_test_email') }}" class="btn btn-primary">Run Test Again</a>
                <a href="{{ path('dashboard_admin') }}" class="btn btn-secondary">Back to Dashboard</a>
            </div>
        </div>
    </div>
    
    <div class="card mt-4">
        <div class="card-header bg-info text-white">
            <h3>Email Configuration</h3>
        </div>
        <div class="card-body">
            <p><strong>MAILER_DSN:</strong> <code>{{ app.request.server.get('MAILER_DSN') }}</code></p>
            <p class="text-muted">If using Gmail, make sure:</p>
            <ul class="text-muted">
                <li>The app password is correct and hasn't expired</li>
                <li>Less secure app access is enabled for your Gmail account</li>
                <li>You don't have 2FA issues that could prevent access</li>
            </ul>
            
            <h4 class="mt-3">Recommendations to Fix Email Issues:</h4>
            <ol>
                <li>Check if the Gmail app password is still valid</li>
                <li>Generate a new app password in your Google account</li>
                <li>Update the MAILER_DSN in your .env file</li>
                <li>Make sure your Gmail account allows access from less secure apps</li>
                <li>Check your PHP error logs for more detailed information</li>
            </ol>
        </div>
    </div>
</div>
{% endblock %}
