{# Fichier : templates/social_media/show.html.twig #}
{% extends 'base.html.twig' %} {# Hérite de votre base partagée #}

{# Définit le titre de la page (sera inséré dans le block title de la base) #}
{% block title %}{{ social_media.getTitre() }} - Détails{% endblock %}

{# Ce bloc REMPLACE le contenu du block body de base.html.twig #}
{% block body %}
<div class="container mt-4 mb-5"> {# Ajout de marges pour l'espacement #}
    <div class="row justify-content-center">
        <div class="col-lg-8"> {# Limite la largeur pour la lisibilité #}

            {# --- Carte Principale du Post --- #}
            <article class="card shadow-sm mb-4 post-card">
                <div class="card-body">
                    {# En-tête du Post avec Image Auteur #}
                    <header class="d-flex align-items-center mb-3 pb-3 border-bottom">
                        {% set post_author = social_media.getUser() %}
                        <div class="me-3 flex-shrink-0"> {# Marge et empêche le rétrécissement #}
                            <img src="{{ post_author and post_author.getImagesU() ? asset('uploads/profile_pictures/' ~ post_author.getImagesU()) : asset('images/placeholder-avatar.png') }}" {# Placeholder si pas d'image #}
                                 alt="{{ post_author ? post_author.getPrenom() : 'Utilisateur' }}"
                                 class="rounded-circle post-author-img">
                        </div>
                        <div class="flex-grow-1"> {# Prend l'espace restant #}
                            <h5 class="mb-0 card-title">
                                {% if post_author %}
                                    <strong>{{ post_author.getPrenom() }} {{ post_author.getName() }}</strong>
                                {% else %}
                                    <em>Utilisateur inconnu</em>
                                {% endif %}
                            </h5>
                            <small class="text-muted card-subtitle">
                                Publié le {{ social_media.getPublicationDate()|date('d/m/Y à H:i') }}
                            </small>
                        </div>
                        {# Boutons Actions (Modifier/Supprimer) en Dropdown #}
                        {% if post_author and post_author.getIdU() == default_user_id %} {# Condition basée sur l'ID utilisateur par défaut propriétaire #}
                            <div class="dropdown ms-auto"> {# ms-auto pousse vers la droite #}
                                <button class="btn btn-light btn-sm" type="button" id="postActionsDropdown{{ social_media.idEB }}" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="postActionsDropdown{{ social_media.idEB }}">
                                    <li>
                                        <a class="dropdown-item" href="{{ path('app_social_media_edit', {idEB: social_media.idEB}) }}">
                                            <i class="bi bi-pencil-square me-2"></i>Éditer
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        {# Formulaire pour Supprimer (POST + CSRF) #}
                                        <form action="{{ path('app_social_media_delete', {idEB: social_media.idEB}) }}" method="POST" class="d-inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette publication ?');">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ social_media.idEB) }}">
                                            <button type="submit" class="dropdown-item text-danger">
                                                <i class="bi bi-trash me-2"></i>Supprimer
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        {% endif %}
                    </header>

                    {# Contenu du Post #}
                    <div class="card-text post-content mb-3">
                        <p>{{ social_media.getContenu()|nl2br }}</p>
                    </div>

                    {# Image du Post #}
                    {% if social_media.getImagemedia() %}
                        <div class="mb-3 post-image-container text-center"> {# Centrer l'image #}
                            <img src="{{ asset('uploads/' ~ social_media.getImagemedia()) }}" {# Assurez-vous que 'uploads/' est le bon chemin public #}
                                 alt="Image pour {{ social_media.getTitre() }}"
                                 class="img-fluid rounded">
                        </div>
                    {% endif %}

                    {# Barre J'aime/Je n'aime pas/Commenter #}
                    <div class="post-actions border-top pt-2 text-center">
                        <div class="row">
                            <div class="col">
                                <button class="btn btn-light w-100" disabled> {# Désactivé pour l'instant #}
                                    <i class="bi bi-hand-thumbs-up"></i> J'aime ({{ social_media.getLikee() }})
                                </button>
                            </div>
                            <div class="col">
                                 <button class="btn btn-light w-100" disabled> {# Désactivé pour l'instant #}
                                     <i class="bi bi-hand-thumbs-down"></i> Je n'aime pas ({{ social_media.getDislike() }})
                                 </button>
                            </div>
                             <div class="col">
                                <a href="#comments" class="btn btn-light w-100"> {# Lien ancre vers la section commentaires #}
                                    <i class="bi bi-chat-dots"></i> Commenter
                                </a>
                            </div>
                        </div>
                    </div>

                </div> {# Fin card-body post #}
            </article> {# Fin article post #}

            {# --- Section Commentaires --- #}
            <section id="comments" class="mt-4">
                <h3 class="mb-3">Commentaires</h3>

                {# Formulaire Ajout Commentaire #}
                <div class="card shadow-sm mb-4">
                    <div class="card-body add-comment-section">
                         {% set commenter_image = asset('images/placeholder-avatar.png') %} {# Placeholder - TODO: Améliorer si possible #}
                         <div class="d-flex align-items-start">
                             <img src="{{ commenter_image }}" alt="Votre avatar" class="rounded-circle comment-author-img me-3">
                             <div class="flex-grow-1">
                                {# Rendu simplifié du formulaire #}
                                <form name="{{ comment_form.vars.name }}" method="{{ comment_form.vars.method }}" action="{{ comment_form.vars.action }}" class="add-comment-form">
                                    <div class="mb-2">
                                        {{ form_widget(comment_form.description, {'attr': {'rows': 2, 'placeholder': 'Écrivez un commentaire...', 'class': 'form-control form-control-sm'}}) }}
                                        {{ form_errors(comment_form.description) }} {# Afficher les erreurs pour ce champ #}
                                    </div>
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-primary btn-sm">
                                            <i class="bi bi-send"></i> Publier
                                        </button>
                                    </div>
                                    {{ form_rest(comment_form) }} {# Important pour le CSRF token et autres champs cachés #}
                                </form>
                             </div>
                         </div>
                    </div> {# Fin card-body form #}
                </div> {# Fin card form #}


                {# Liste des Commentaires Existants #}
                <div id="comments-list">
                    {% if comments is defined and comments|length > 0 %}
                        {% for commentaire in comments %} {# Itération sur les commentaires paginés #}
                            {% set comment_author = commentaire.getUser() %}
                            <div class="d-flex align-items-start mb-3 comment-entry">
                                 {# Image Auteur Commentaire #}
                                <div class="me-3 flex-shrink-0">
                                    <img src="{{ comment_author and comment_author.getImagesU() ? asset('uploads/profile_pictures/' ~ comment_author.getImagesU()) : asset('images/placeholder-avatar.png') }}"
                                         alt="{{ comment_author ? comment_author.getPrenom() : 'Avatar' }}"
                                         class="rounded-circle comment-author-img">
                                </div>
                                 {# Bulle Commentaire #}
                                <div class="flex-grow-1">
                                    <div class="comment-bubble p-2 rounded">
                                        <strong>
                                            {% if comment_author %}
                                                {{ comment_author.getPrenom() }} {{ comment_author.getName() }}
                                            {% else %}
                                                Utilisateur inconnu
                                            {% endif %}
                                        </strong>
                                        <p class="mb-0 comment-text">{{ commentaire.getDescription()|nl2br }}</p>
                                    </div>
                                    {# Meta Données Commentaire #}
                                    <div class="comment-meta mt-1">
                                        <small class="text-muted">
                                            {# Afficher l'ID en attendant createdAt #}
                                            ID: {{ commentaire.idC }} {# TODO: Remplacer par la date quand elle existera #}
                                        </small>
                                        {# Liens actions commentaire (placeholders) #}
                                        <a href="#" class="text-muted small ms-2 comment-action-link">J'aime</a>
                                        <span class="text-muted small">·</span>
                                        <a href="#" class="text-muted small comment-action-link">Répondre</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}

                        {# Liens Pagination #}
                        <div class="navigation d-flex justify-content-center mt-4">
                            {{ knp_pagination_render(comments) }}
                        </div>

                    {% else %}
                        {# Message si pas de commentaires #}
                        <div class="alert alert-light text-center border" role="alert">
                           <small class="text-muted"> Il n'y a pas encore de commentaires.</small>
                        </div>
                    {% endif %}
                </div> {# Fin comments-list #}

            </section> {# Fin section commentaires #}

        </div> {# Fin col-lg-8 #}
    </div> {# Fin row #}
</div> {# Fin container #}
{% endblock %} {# Fin block body #}


{# Utilise le nom de bloc JS de la base #}
{% block js %}
    {{ parent() }} {# Inclut les JS définis dans le bloc 'js' de base.html.twig #}
    {# Ajoutez ici des scripts JS spécifiques à cette page si nécessaire #}
{% endblock %}


{# Utilise le nom de bloc CSS de la base #}
{% block css %}
    {{ parent() }} {# Inclut les CSS définis dans le bloc 'css' de base.html.twig #}
    {# Styles CSS spécifiques à cette page #}
    <style>
        .post-card .card-title {
            font-size: 1.1rem;
            margin-bottom: 0.1rem;
        }
        .post-author-img {
            width: 40px;
            height: 40px;
            object-fit: cover; /* Assure que l'image couvre la zone sans déformation */
        }
        .comment-author-img {
            width: 32px;
            height: 32px;
            object-fit: cover;
        }
        .post-content p {
            line-height: 1.6;
            white-space: pre-wrap; /* Respecte les retours à la ligne et les espaces */
            font-size: 1rem;
        }
        .post-image-container img {
            max-width: 100%;
            height: auto; /* Garde les proportions */
        }
        .post-actions .btn {
            font-size: 0.9rem;
            color: #606770; /* Couleur de texte type gris Facebook */
            font-weight: 500;
        }
        .post-actions .btn:hover {
            background-color: #f0f2f5; /* Hover léger gris */
        }
        .add-comment-section textarea {
             background-color: #f0f2f5; /* Fond gris clair type Facebook */
             border: none; /* Pas de bordure */
             border-radius: 18px; /* Très arrondi */
             padding: 8px 12px;
             line-height: 1.3; /* Ajuster la hauteur de ligne */
        }
        .add-comment-section textarea:focus {
             background-color: #e4e6eb; /* Un peu plus foncé au focus */
             box-shadow: none; /* Pas d'ombre au focus */
        }
        .comment-entry {
            /* Espacement entre les commentaires si nécessaire */
        }
        .comment-bubble {
            background-color: #f0f2f5; /* Fond gris clair */
            display: inline-block; /* S'adapte au contenu */
            padding: 8px 12px;
            border-radius: 18px; /* Très arrondi */
            word-wrap: break-word; /* Coupe les mots longs */
            font-size: 0.9rem;
        }
        .comment-bubble strong {
            font-size: 0.85rem;
            display: block; /* Nom sur sa propre ligne */
            margin-bottom: 2px;
            color: #050505; /* Noir léger pour le nom */
        }
        .comment-text {
             margin: 0;
             color: #050505; /* Noir léger pour le texte */
         }
        .comment-meta {
             font-size: 0.75rem;
             padding-left: 12px; /* Aligné un peu avec la bulle */
             margin-top: 4px; /* Petit espace après la bulle */
             color: #606770;
         }
        .comment-action-link {
             text-decoration: none;
             font-weight: 600;
             color: #606770; /* Gris pour les liens */
         }
        .comment-action-link:hover {
             text-decoration: underline;
         }
         /* Assurer que le container a de l'espace par rapport au header fixed-top */
         body {
             padding-top: 70px; /* Ajustez cette valeur si la hauteur de votre header est différente */
         }
         main.main-content { /* Cible le main ajouté dans la proposition de base.html.twig */
            padding-top: 1rem; /* Espace supplémentaire si nécessaire */
         }
    </style>
{% endblock %}